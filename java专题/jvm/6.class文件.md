# class文件

以8位为基本单位的二进制数据，没有任何分隔符，中间没有间隙。当遇到大于8位的时候，高在前，低位在后，分成8位来存储。

## 存储

采用伪格式：无符号数和表。

**无符号数**：
u1 u2 u4 u8,可以存储数字/索引引用/数量值/或者utf-8编码构成字符串值。

**表：**
表由多个无符号数或者其他表作为数据项构成的符合数据类型。用于表示层次关系的复合数据。

无论那种，如果数据个数不确定的时候就先一个计数器 + 一串数据

因为没有分隔符，那么他们的数据值等信息是按照严格的要求的。

## class文件

### 魔数

u4:4个字节魔数，魔数一般表示文件的格式。一般不使用后缀名，后缀名会进行修改。紧跟随后的是版本，主版本 此版本各为u2。  
版本的作用，就是判断当前这个字节码是不是我本虚拟机可以处理的。或者是当前class文件可以被处理的最低虚拟机版本。

### 常量池

紧跟着的是常量池的入口，它是class的资源仓库，与class文件其他项目的关联最多的数据类型，也是占用的空间最大的。

它是一个表。

常量池的常量不是固定的，一个计数器，表示容量，后面跟着一个表，下标是从1开始，不是0 ，因为0 位置可以表示一个没有任何指向的位置。

**存储：**

存放两类数据：字面量/符号引用

- 字面量：字符串   final声明的常量值

- 符号引用：编译原理方面

    - 类和接口的全限名

    - 字段名称和描述符

    - 方法的名称和描述符

javac生成字节码，并不会连接操作。在加载的过程中动态的链接
字节码不会保存方法，字段的具体内存布局。虚拟机在运行的时候在从常量池中获取对应的符号引用，在类创建或者解析，翻译到具体的地址。

每一项常量都是一个表，一共有14个类型。1.7的时候。

**第一位表示标志位，表示使用那种常量类型，**

- 字符串
- 整数
- 浮点
- 长整型
- 双精度浮点型
- 类或者接口
- 字符串类型字面量
- 字段符号引用
- 类中方法引用符号
- 接口中方法引用符号
- 字段和方法符号引用
- 方法句柄
- 表示方法类型
- 表示动态方法调用点

### class_info

    tag     +   index
   标识符     类的全限名索引值

### utf-8

    tag     +    length     +       class name
   标识符      字符串的常量             字符出值

    u1             u2                   u1

   最长位65535

### integer

    tag    +     bytes
                高位在前
    u1             u4

### Float

    tag     +   bytes

    u1             u4

### Long

    tag     +   bytes

    u1            u8

### Double

    tag     +   bytes

### class

    tag     +   index

### String

    tag     +   index

### fieldref 

    tag         +       index       +       index
                指向字段或者类的索引项      指向字符描述符

### interface 

    tag         +       index       +       index
                指向方法的类描述符      指向字符描述符

## 访问标志位

- public

- final

- invokespecial字节码新语义

- 接口

- 抽象

- 类产生方式

- 注解

- 枚举

16位现在只定义了8项，未使用到的为0

u16

## 类索引/父类索引/接口索引集合

类和父类只有一个u2

接口是一组数据的集合，单继承/多实现

- 类索引--->指向常量池的utf-8

- 接口索引集合  接口计数器，接口的容量，如果没有实现任何接口，那么就为0 ，后面接口的索引不占用任何空间。

## 字段表集合

容量计数器  标记  字段名称

字段表描述接口或者剋中声明的变量。

类变量和实例变量，不包括局部变量（线程私有的）

- 作用域

- 类变量

- 可变性

- 并发可见性

- 可否序列化

- 字段数据类型

- 字段名称

access_flags        name_index     简单名称   方法描述符
descriptor_index    attributes_count
attributes

简单名称：没有类型   参数修饰 的方法或者字段
比如inc()方法和字段m简单名称为inc  m

描述符：字段的数据类型/方法列表/返回值。

描述符的规则：

### 描述符表示其他

- 基本数据类型和void都使用一个大写字符表示。V (void)  Z（boolean）

- 对象的类型：字符L加对象的全限定名来表示。 Ljava/lang/Object

- 数组 [[ / [

### 描述符表示方法

参数列表/返回值的顺序

```java
void inc()            ()V
java.lang.String toString()    ()Ljava/lang/String;
int indexOf(char[] source,int sourceOffset,int sourceCount,Char[]target)
        ([CII[C)I;
```

## 方法表集合

## 属性表集合

在class文件/字段表/方法表都存在携带自己属性的集合


# 